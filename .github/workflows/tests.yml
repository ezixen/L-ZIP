name: L-ZIP Tests and Validation

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ['3.8', '3.9', '3.10', '3.11']

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
    
    - name: Run unit tests
      run: python test_lzip.py
    
    - name: Run validation tests
      run: python validate.py
    
    - name: Run demo
      run: python demo_lzip.py
    
    - name: Test CLI
      run: |
        echo "Testing CLI help"
        python cli.py --help || python cli.py | head -5 || true

  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.11
    
    - name: Check Python syntax
      run: |
        python -m py_compile lzip.py mcp_server.py cli.py test_lzip.py validate.py demo_lzip.py examples.py

  coverage:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.11
    
    - name: Install coverage tools
      run: pip install coverage
    
    - name: Run tests with coverage
      run: coverage run -m pytest test_lzip.py 2>/dev/null || python test_lzip.py
    
    - name: Generate coverage report
      run: coverage report --include="lzip.py,mcp_server.py" 2>/dev/null || echo "Coverage reporting skipped"
